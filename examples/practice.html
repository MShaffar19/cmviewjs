<html>
  <head>
	<!--script type="text/javascript" src = "cmcanvas.js"></script-->
	
	
  </head>
  <body>
  	<script type = "text/javascript" src = "cmcanvas.js"></script>
    <!--script src="cmview.js"></script-->
  

	<div id = "cmview" style="width: 700px;"></div>
    <canvas id="canvas" style="border: 1px solid" width="900" height="900"></canvas>
    <canvas id="zoom" width="200" height="200"></canvas>

    
    <script language="javascript">
   	//load();
    //CMV.load();
	</script>


	<script src="ngl.dev.js"></script>
	<script>

	//"rcsb://1crn.mmtf"
    
    //testing out how to connect NGL
    var canvas = document.getElementById('canvas');
    
    var stage; 
    var structurecomp;

    //load(unit);

    var canvasobj = new canvasclass("cmv1");
    canvasobj.loadcanvas();
    //canvasobj.drawcanvas();





    var loadngl = function(){
        stage = new NGL.Stage( "viewport" );
        //then(distancecal);
        stage.loadFile( "rcsb://1smt.mmtf", { defaultRepresentation: true } ).then( function( o ){

        structurecomp = o;

        //var atomPair = [ [9, 30] ];
        //structurecomp.addRepresentation( "distance", { atomPair: atomPair } );
        

    } );
        
    }

    document.addEventListener( "DOMContentLoaded", loadngl);




    var tag = 0;
    var repr;


    //adding distance representation 
    var trace = function(event){
      var x = event.layerX;
      var y = event.layerY;

      var xloc = Math.floor(x/5.7);
      var yloc = Math.floor(y/5.7);

      //console.log("xloc: "+xloc);
      //console.log("yloc: "+yloc);

      //console.log("x: " + xloc);
      //console.log("y: " + yloc);

      //loadngl(xloc, yloc);

      structurecomp.addRepresentation( "cartoon" );
    // either give selections (uses first selected atom) ...
      //var atomPair = [ [ "1.CA", "4.CA" ], [ "7.CA", "13.CA" ] ];
    // or atom indices
      //var atomPair = [ [xloc, yloc] ];
      //atompairglobal = atomPair;
      if(tag == 1){
        structurecomp.removeRepresentation(repr);
      }
      var atomPair = [[xloc,yloc]];
      repr = structurecomp.addRepresentation( "distance", { atomPair: atomPair } );
      tag = 1;
      stage.centerView();

    }

    canvas.addEventListener('click', trace);




	</script>

	<div id="viewport" style="width:500px; height:500px;"></div>



  </body>
</html>





